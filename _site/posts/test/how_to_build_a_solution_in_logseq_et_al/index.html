<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-01-06">

<title>For the Wynn - How to Build a Solution in Logseq, Obsidian, etc.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">For the Wynn</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../me.html"> 
<span class="menu-text">David Wynn</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/DavidBWynn"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/FTWynn"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">How to Build a Solution in Logseq, Obsidian, etc.</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 6, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<blockquote class="blockquote">
<p>Simple is nearly always better. But if it’s going to be complicated, then make sure the problem is worth the complexity. A great deal of time is wasted creating complex solutions to relatively unimportant problems. - James Clear</p>
</blockquote>
<blockquote class="blockquote">
<p>A complex system that works is invariably found to have evolved from a simple system that worked. The inverse proposition also appears to be true: A complex system designed from scratch never works and cannot be made to work. You have to start over, beginning with a working simple system. - John Gall</p>
</blockquote>
<p>CRM in Tana https://www.youtube.com/watch?v=N4YXh0ynmy0 This seemed insane that he’d gotten an hour into doing this and hadn’t saved a single person</p>
<p>Hello fellow PKM user, both new and old alike!</p>
<section id="what-is-this" class="level2">
<h2 class="anchored" data-anchor-id="what-is-this">What is this?</h2>
<p>I’ve been dabbling in PKMs for a few years now, and I’ve noticed a bit of a pattern in the current wave of PKM content creation that holds regardless of tool, from org mode to Obsidian to Logseq.</p>
<p>Mainly, there seems to be a fascination with sharing how solutions are built in side of Tools for Thought… but they all focus on the scaffolding and the setup! They’re presented as this single point in time of structure formation, and even if they speak to an iterative process, those steps are largely left out of the explanation.</p>
<p>Well no longer! I’m writing this post (mostly) not to teach you how to handle recpies in a PKM, but instead to teach you how to build <em>any</em> solution for yourself in a PKM.</p>
<p>To be clear, this is a <strong>hard</strong> problem. PKM’s are so powerful these days that you <em>could</em> do almost anything. That makes the paralyzing analysis of what you <em>should</em> be doing all the more terrifying. Much easier to copy what seems to be working from someone else.</p>
<p>Fortunately, we deal with this in the tech industry all the time! Computer software is fundamentally a blank canvas, and a literal infinite number of things could be created. As a result, there are some methods from the tech world I’ll share with you today on how to build your very own solutions in your PKM of choice.</p>
<p>I’ll use LogSeq for my example, but any PKM will work.</p>
<p>To start, the key steps.</p>
</section>
<section id="the-key-steps" class="level2">
<h2 class="anchored" data-anchor-id="the-key-steps">The Key Steps</h2>
<section id="think-of-what-you-want" class="level3">
<h3 class="anchored" data-anchor-id="think-of-what-you-want">1 - Think of what <em>you</em> want</h3>
<p>The most important letter in PKM is <strong>P</strong>, because everyone thinks about the world differently in their head. As a result, the problems we face, while probably similar to others, will have their quirks unique to us given our strengths and weaknesses we each bring to the table. So the first step is to think hard very about a given problem.</p>
<p>What are your goals for this thing you’re thinking about doing in a PKM? What would it feel like when it’s finished and working smoothly? What do you do today for this problem instead that works fairly well? What do you do today that doesn’t work well?</p>
<p>All of this is good information to capture on paper/a screen somewhere so you can keep refining the ideas as you go. Don’t assume you just have it all in your head. Write. it. down.</p>
</section>
<section id="map-the-goals-into-user-journeys" class="level3">
<h3 class="anchored" data-anchor-id="map-the-goals-into-user-journeys">2 - Map the goals into user journeys</h3>
<p>We have something in software development called user journeys. These are single sentences that tend to be phrased as…</p>
<blockquote class="blockquote">
<p>As a [type of person], I want [to do/to have something]</p>
</blockquote>
<p>With your goals above in mind, start crystalizing the things you want your solution to do in these sentences. It’ll be a little forced at first, but the whole point is to translate the pieces of your problem you want solved into smaller, discrete features. Building the list this way lets you tackle each thing one by one once you start building.</p>
<p>An interesting thing you may notice after creating a few of these is that you can think of yourself as multiple types of person, creating mini-personalities that your solution needs to cater to. For example, maybe you’re a perfectionist, but you’re also lazy, and you’re also away from a laptop a lot, and you get interrupted pretty regularly… these are all great personas to capture, because they all have different features they want (and sometimes want different ways to solve the same problem).</p>
<p>As such, the user journeys don’t have to all be coherent. You’re allowed want multiple, contradictory things at once. The point of this exercise is to make explicit the things you want so you can think through what the solution personalized to <em>you</em> should look like. Building things is all about trade-offs, and making all the conflicting desires clear makes it much easier to judge trade-offs later.</p>
<p>User journeys should encapsulate something that delivers value to the persona listed. So, “As an organized person, I want to have a schema for my data” isn’t good enough. You need something like “As a lazy person, my CRM should prompt me to fill in info I should have even if I don’t have it yet.” It’s a whole feature, not a stepping stone you might need to do to make a feature possible.</p>
<p>Good User Journeys: - As a distracted person, I want a way to capture an idea as fast as possible without interrupting what I’m doing - As a forgetful person, I want to be reminded when to reach out to friends and say hello - As an interative improver, I want to see what I’ve already tried as I attempt a new thing</p>
<p>Bad User Journeys: - As an organizer, I want to define the right schema for my contacts - As a developer, I want to build a CRM - As a solution designer, I want to finish designing a solution for storing recipes</p>
<p>When you’ve got a bunch written down, order them from most important to least important. Perfection doesn’t matter, just get a rough ordering. This effectively becomes your TODO list.</p>
</section>
<section id="relentlessly-focus-on-satisfying-one-user-journey-after-the-other-until-youre-through" class="level3">
<h3 class="anchored" data-anchor-id="relentlessly-focus-on-satisfying-one-user-journey-after-the-other-until-youre-through">3 - Relentlessly focus on satisfying one user journey after the other until you’re through</h3>
<p>Now that we’ve itemized our goals into user journeys, and then prioritized them by importance, was so we could tackle one piece at a time. There’s no need to boil the ocean by doing everything from the start. Do something discrete, that solves a problem for a part of yourself, and then add on from there.</p>
<p>Doing one thing at a time is freeing, by eliminating a bunch of extraneous concerns that might pop into your head. If you’re anything like me, distractions are always at hand, and this focus brings momentum to the project.</p>
<p>You don’t have to complete every User Journey of course. Some may turn out to be impossible. That’s OK. Mark it as attempted and abandoned and go to the next one.</p>
<p>Also, don’t feel tied to your original ordering. Work on one at a time until a journey done or abandoned, but you can re-arrange the list at any time either according to your need or even just your whims. This is all to help you, not to hurt you.</p>
<p>That’s pretty much it for the general steps. That said, there are some things I encourage you to keep in mind as you build things in your CRM…</p>
</section>
</section>
<section id="key-things-to-keep-in-mind" class="level2">
<h2 class="anchored" data-anchor-id="key-things-to-keep-in-mind">Key things to keep in mind</h2>
<section id="do-less" class="level3">
<h3 class="anchored" data-anchor-id="do-less">Do less</h3>
<p>This is <em>extremely</em> important. The less you do, the less you have to build. The less you build, the less you maintain.</p>
<p>There are no bugs in things you decide not to build.</p>
<p>So do not presume your solution needs to be complicated. In fact, always to strive to make it as simple and barebones as you can get away with.</p>
<p>Remember, the goal is to <em>do the stuff your PKM enables</em>, not to organize your life the “correct” way to be organized.</p>
</section>
<section id="use-native-tooling-whenever-possible" class="level3">
<h3 class="anchored" data-anchor-id="use-native-tooling-whenever-possible">Use native tooling whenever possible</h3>
<p>Most PKMs support plugins to some degree. Many of these are amazing and borderline magical.</p>
<p>DO NOT DEPEND ON THEM for your solution if you can possibly avoid it.</p>
<p>You’re already depending on a PKM to make your solution, it’s not wise to add another dependency on a tool that isn’t guaranteed to keep up to date (and is more likely to change) unless you absolutely have to.</p>
<p>And change is a big deal in making a solution in a PKM. The plugin environment everywhere is rapidly evolving at a frankly ludicrous pace. Things that work one way today might work very differently tomorrow.</p>
<p>Be absolutely sure that risk is worth it if you choose to depend on a plugin. Does it really have to be in a Kanban board? Can I add a metadata field or two and achieve the same effect? If I work really hard on a particular query, does it do pretty much the same thing for this specific case?</p>
</section>
<section id="it-will-feel-weird-full-of-warts-and-yours" class="level3">
<h3 class="anchored" data-anchor-id="it-will-feel-weird-full-of-warts-and-yours">It will feel weird, full of warts, and <em>yours</em></h3>
<p>Do not be ashamed of it feeling hacked together! This is a <em>good</em> thing!</p>
<p>That means it hews as close as possible to your needs, with nothing for anyone else!</p>
<p>Embrace the bad!</p>
<p>Anything worth doing is worth doing poorly!</p>
</section>
<section id="there-is-no-right-answer" class="level3">
<h3 class="anchored" data-anchor-id="there-is-no-right-answer">There is no “right” answer</h3>
<p>Similar to the above, feel free to get inspiration from others, but be very wary of thinking that anyone else has the <em>exact</em> solution to your problem.</p>
<p>Sure, it could happen. But odds are it completely works for them, and will work 90% for you.</p>
<p>Good artists copy. Great artists steal. Incorporate others’ ideas into your own work, but don’t overvalue it compared to what you bring to the table.</p>
<p>I love Eleanor Konik in the Obsidian community, because she is extremely open about borrowing ideas from other places (Johnny Decimal, Maps of Content, etc.), and then not following them to perfection because they don’t work for this or that thing she needs to do.</p>
</section>
<section id="there-are-some-great-filler-practices-for-tooling-gaps" class="level3">
<h3 class="anchored" data-anchor-id="there-are-some-great-filler-practices-for-tooling-gaps">There are some great filler practices for tooling gaps</h3>
<p>We’re talking a lot about building a solution in a PKM here, which is a form of tool. However, there are some great filler practices that can make up for some tricky tool deficiencies.</p>
<p>For example, I do a morning and evening journal. If I tack on a little checklist to the journal prompt, I now have an escape hatch for any number of processes that are otherwise very tricky to implement in some PKM’s.</p>
<p>Do you really need to write a date scoped query to pull the not-so-recently updated contacts in your CRM, or can you just check every night to see if any have fallen too out of date?</p>
</section>
<section id="crappily-finished-is-way-better-than-perfect-in-your-head" class="level3">
<h3 class="anchored" data-anchor-id="crappily-finished-is-way-better-than-perfect-in-your-head">Crappily finished is way better than perfect in your head</h3>
<p>Ze Frank has an old video about brain crack that still haunts me. The gist is this: an idea in your head can be addictive. It can feel good to think about it, and how perfect it can be, without every actually implementing it.</p>
<p>But you have to resist that. A bad version that works is infinitely better than a perfect version that’s only in your imagination.</p>
</section>
<section id="focus-on-making-small-positive-units-of-value-then-grow" class="level3">
<h3 class="anchored" data-anchor-id="focus-on-making-small-positive-units-of-value-then-grow">Focus on making small, positive units of value, then grow</h3>
<p>You won’t stick with pain to eventually get to something that COULD be good.</p>
<p>Starting with the important stuff, finishing a useful unit of work, and then going to the next is the best way to build this up. We’re going for an incremental approach… to get better over time.</p>
<p>Start with the simple systems that work. If you’re building a CRM, just having a page for each contact with a tag is good enough to start. <em>Then</em> you can worry about templates. And then links. And so on.</p>
</section>
<section id="you-need-to-be-radically-honest-and-non-judgmental-of-yourself" class="level3">
<h3 class="anchored" data-anchor-id="you-need-to-be-radically-honest-and-non-judgmental-of-yourself">You need to be radically honest and non-judgmental of yourself</h3>
<p>You will have things you do and things you don’t do</p>
</section>
<section id="listen-to-and-lean-into-your-idiosyncrasies." class="level3">
<h3 class="anchored" data-anchor-id="listen-to-and-lean-into-your-idiosyncrasies.">Listen to, and lean into your idiosyncrasies.</h3>
<p>You’re an audience of 1! Use that privileged knowledge!</p>
</section>
</section>
<section id="an-example-recipes-in-pkm" class="level2">
<h2 class="anchored" data-anchor-id="an-example-recipes-in-pkm">An example: Recipes in PKM</h2>
<section id="done-start-doing-recipes" class="level3">
<h3 class="anchored" data-anchor-id="done-start-doing-recipes">DONE Start doing recipes</h3>
<p>:logbook: CLOCK: [2022-08-17 Wed 07:54:43]–[2022-08-17 Wed 07:54:44] =&gt; 00:00:01 :END: DONE How to handle recipe part? I don’t think this needs to be super formal Some recipes will have a list of ingredients Others will just have descriptions like the Scrambled Eggs DONE How to handle implementation notes? DONE I could make an example iteration template DONE Should I link all the ingredients together for recipe discovery? :logbook: CLOCK: [2022-08-12 Fri 19:02:33]–[2022-08-12 Fri 19:02:33] =&gt; 00:00:00 :END: There are probably better apps for this The goal of this exercise is mostly to capture my notes on each attempt and tweaks for improvement ### Start with goals What do I want out of keeping recipes in my PKM? Personally, I care a lot about iteration How do I know it’s working? How would I know it’s broken? ### Move on to CUJ’s, if not interspersing them with goals As a ____, I want to blank ### Then start implementing one at a time How should we implement this? Tags? Single notes page? Multiple notes pages? Daily Note? Templates?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>